Some changes made from github.com/M3M12G
